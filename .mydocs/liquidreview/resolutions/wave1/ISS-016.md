# ISS-016: Block Interface Definition Mismatch

**Issue Type:** Consistency Issue
**Severity:** High
**Status:** Resolved
**Date:** 2025-12-21

---

## Problem Statement

The `Block` interface is defined inconsistently between §4.1 (main specification) and §10.3 (Signal System section), creating ambiguity about the normative structure.

### Location A: §4.1 (Lines 168-177)

```typescript
interface Block {
  uid: string;               // Stable unique identifier (required, see B.2)
  type: BlockType;           // What kind of block
  id?: string;               // User-assigned semantic ID (optional)
  binding?: DataBinding;     // What data it displays (optional for layout blocks)
  slots?: SlotMap;           // Where child blocks go (optional)
  signals?: SignalConnections; // How it participates in reactivity (optional)
}
```

### Location B: §10.3 (Lines 778-795)

```typescript
interface SignalConnections {
  emits?: SignalEmission[];
  receives?: SignalReception[];
}

interface SignalEmission {
  signal: string;             // Name from registry
  trigger: TriggerType;       // When to emit
  transform?: string;         // Value transformation
}

interface SignalReception {
  signal: string;             // Name from registry
  target: string;             // Binding path to update
  transform?: string;         // Value transformation
}
```

### Location C (Authoritative): B.6.1 (Lines 2332-2344)

```typescript
interface Block {
  // REQUIRED fields
  uid: string;                           // Stable unique identifier
  type: BlockType;

  // OPTIONAL fields
  id?: string;                           // User-assigned ID
  binding?: DataBinding;
  slots?: Record<string, Block[]>;
  signals?: SignalConnections;
  layout?: BlockLayout;
  constraints?: RenderConstraints;
}
```

---

## Discrepancies Identified

1. **Missing Fields in §4.1:**
   - `layout?: BlockLayout` (present in B.6.1, missing in §4.1)
   - `constraints?: RenderConstraints` (present in B.6.1, missing in §4.1)

2. **Type Inconsistency:**
   - §4.1 uses `slots?: SlotMap` where `SlotMap = Record<string, Block[]>`
   - B.6.1 uses `slots?: Record<string, Block[]>` directly
   - These are semantically equivalent but syntactically different

3. **Incomplete Context:**
   - §4.1 is an early conceptual introduction
   - §10.3 focuses only on signal-related fields
   - Neither location provides the complete, normative definition

---

## Resolution

### Authoritative Source

**Appendix B.6.1** (lines 2332-2344) is the normative definition. As stated in B.6:

> **B.6 Normative LiquidSchema Specification**
> **Problem:** Partial schema specification leads to implementation divergence, broken caching, and adapter incompatibilities.
> **Solution:** Complete, normative schema with JSON Schema, TypeScript types, and canonical ordering.

### Required Changes

#### 1. Update §4.1 to Reference Normative Definition

**Current (lines 168-177):**

```typescript
interface Block {
  uid: string;               // Stable unique identifier (required, see B.2)
  type: BlockType;           // What kind of block
  id?: string;               // User-assigned semantic ID (optional)
  binding?: DataBinding;     // What data it displays (optional for layout blocks)
  slots?: SlotMap;           // Where child blocks go (optional)
  signals?: SignalConnections; // How it participates in reactivity (optional)
}
```

**Replacement:**

```typescript
interface Block {
  // REQUIRED fields
  uid: string;               // Stable unique identifier (see B.2)
  type: BlockType;           // What kind of block

  // OPTIONAL fields
  id?: string;               // User-assigned semantic ID (optional)
  binding?: DataBinding;     // What data it displays (optional for layout blocks)
  slots?: Record<string, Block[]>;  // Where child blocks go (optional)
  signals?: SignalConnections;      // How it participates in reactivity (optional)
  layout?: BlockLayout;      // Layout and responsive properties (see §11)
  constraints?: RenderConstraints;  // Render-time constraints
}

// Note: For complete normative definition, see B.6.1
```

#### 2. Remove SlotMap Type Alias (Line 193)

**Current:**
```typescript
type SlotMap = Record<string, Block[]>;
```

**Action:** Remove this line. The inline type `Record<string, Block[]>` is clearer and matches the normative definition.

#### 3. Update References to SlotMap

Search for all uses of `SlotMap` in the document and replace with `Record<string, Block[]>`.

**Known Occurrences:**
- Line 193: Type definition (remove)
- Line 173: Block interface (already addressed above)

---

## Validation

After applying these changes:

1. ✅ §4.1 matches B.6.1 structure (with added inline comments for pedagogy)
2. ✅ All optional fields are documented
3. ✅ Type consistency achieved (`Record<string, Block[]>` everywhere)
4. ✅ Cross-references to B.6.1 added for implementers
5. ✅ No semantic changes (SlotMap and Record are equivalent)

---

## Implementation Notes

### For Spec Editors

- The change from `SlotMap` to `Record<string, Block[]>` is a **simplification**, not a breaking change
- §4.1 remains pedagogical; B.6.1 remains normative
- Consider adding a note at the end of §4 pointing to B.6 for complete types

### For Implementers

- If your code uses `SlotMap` as a type, no change needed (it's just an alias)
- Use B.6.1 as the source of truth for schema validation
- The addition of `layout` and `constraints` fields does not break existing schemas (they are optional)

---

## Related Issues

- ISS-017: Signal Transform Type Conflict (affects `SignalEmission` and `SignalReception`)
- ISS-018: Address Resolution Priority Order (uses Block UIDs)

---

## Checklist

- [x] Discrepancies identified
- [x] Authoritative source determined (B.6.1)
- [x] Non-authoritative locations identified (§4.1, §10.3)
- [x] Specific changes documented
- [x] Validation criteria defined
- [x] Implementation notes provided

---

**Resolution Authority:** Appendix B.6 (Normative LiquidSchema Specification)
**Change Scope:** Non-breaking (additive and clarifying)
**Priority:** Must fix before v2.0 publication
