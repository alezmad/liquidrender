# rules.yaml - Human-curated project conventions
# This file captures knowledge that can't be extracted from code

project:
  name: LiquidRender
  description: DSL-to-React rendering engine on TurboStarter

conventions:
  reuse_first:
    - CHECK capabilities.yaml BEFORE creating anything new
    - Extend existing components, don't duplicate
    - TurboStarter features are NOT to be rebuilt

  components:
    - Use design tokens from utils.ts, never hardcode colors or spacing
    - Include data-liquid-type attribute on root element
    - Handle empty/null states gracefully
    - Provide both dynamic and static variant exports
    - File structure: Types → Styles → Helpers → Sub-components → Main → Static
    - Use formatDisplayValue() and fieldToLabel() for display

  code_style:
    - No any types in TypeScript
    - Prefer const over let
    - Use async/await for I/O operations
    - Adapt documentation examples to match existing patterns

  database:
    - Create migration for every schema change
    - Use Drizzle ORM patterns from existing schema files

folders:
  read_freely:
    - .context/
    - _bmad-output/
    - .scratch/

  ask_first:
    - .mydocs/

  do_not_read:
    - .archived/

conflict_resolution:
  # In order of priority (highest first)
  - User's explicit instruction
  - Root CLAUDE.md
  - .context/CLAUDE.md
  - _bmad-output/ documents
  - Framework docs

reference_files:
  design_tokens: packages/liquid-render/src/renderer/components/utils.ts
  dsl_spec: packages/liquid-render/specs/LIQUID-RENDER-SPEC.md
  component_guide: packages/liquid-render/docs/COMPONENT-GUIDE.md

todowrite_patterns:
  # For workflows: track WAVES not individual tasks
  workflows:
    - "Wave N [PARALLEL]: Description (T1,T2,T3)"
    - "Wave N [SEQUENTIAL]: Description"
    - NEVER list individual tasks as separate todos

  # For typecheck errors: ONE TODO PER FILE (parallel fixes)
  typecheck_errors:
    description: |
      When fixing TypeScript errors across multiple files, create ONE todo
      per file to enable parallel mental model and organized tracking.
    example:
      - content: "Fix types in src/components/button.tsx (3 errors)"
        status: in_progress
        activeForm: "Fixing button.tsx types"
      - content: "Fix types in src/hooks/use-auth.ts (2 errors)"
        status: pending
        activeForm: "Fixing use-auth.ts types"
      - content: "Fix types in src/utils/format.ts (1 error)"
        status: pending
        activeForm: "Fixing format.ts types"
    rationale: |
      Each file's errors are independent and can be fixed in parallel.
      Grouping by file provides clear progress visibility and prevents
      jumping between files randomly.
