# Resolution: ISS-038

## Status: ✅ RESOLVED

## Issue Summary
**Title:** RenderConstraints Type Undefined
**Severity:** critical
**Target:** SPEC
**Section:** B.6.1

## Resolution

### Original Content

RenderConstraints is referenced in the Block interface definition (line 2343) but never defined:

```typescript
interface Block {
  // REQUIRED fields
  uid: string;                           // Stable unique identifier
  type: BlockType;

  // OPTIONAL fields
  id?: string;                           // User-assigned ID
  binding?: DataBinding;
  slots?: Record<string, Block[]>;
  signals?: SignalConnections;
  layout?: BlockLayout;
  constraints?: RenderConstraints;       // ← UNDEFINED TYPE
}
```

### Replacement Content

Add the following interface definition to B.6.1 Complete Type Definitions, immediately after the `RelationshipSpec` interface (after line 2444):

```typescript
interface RenderConstraints {
  // Timing constraints
  timeout?: number;                      // Max render time in milliseconds (default: 5000)

  // Data constraints
  requireData?: boolean;                 // If true, block must have data (default: false)
  allowPartialData?: boolean;            // If true, render with partial data (default: true)

  // Feature constraints
  requiredFeatures?: string[];           // Features block depends on (e.g., ['signals', 'streaming'])

  // Performance constraints
  maxDataRows?: number;                  // Maximum rows before pagination/virtualization required
  maxRenderNodes?: number;               // Maximum DOM nodes this block can produce

  // Accessibility constraints
  a11y?: A11yConstraints;                // Accessibility requirements

  // Platform constraints
  platforms?: PlatformConstraint[];      // Supported platforms

  // Degradation behavior
  fallbackMode?: 'placeholder' | 'empty' | 'error'; // How to degrade when constraints violated
}

interface A11yConstraints {
  minContrastRatio?: number;             // Minimum WCAG contrast ratio (e.g., 4.5)
  requiresKeyboardNav?: boolean;         // Block must be keyboard navigable
  requiresScreenReader?: boolean;        // Block must work with screen readers
  ariaRole?: string;                     // Required ARIA role
}

interface PlatformConstraint {
  platform: 'web' | 'mobile' | 'desktop' | 'terminal';
  minVersion?: string;                   // Minimum platform version
  unsupportedFeatures?: string[];        // Features unavailable on this platform
}
```

Update the FIELD_ORDER constant in B.6.2 to include the new interfaces:

```typescript
const FIELD_ORDER = {
  LiquidSchema: ['version', 'scope', 'uid', 'id', 'title', 'description',
                 'generatedAt', 'layout', 'blocks', 'signals', 'slotContext',
                 'signalInheritance', 'explainability', 'metadata'],
  Block: ['uid', 'id', 'type', 'binding', 'slots', 'signals', 'layout', 'constraints'],
  RenderConstraints: ['timeout', 'requireData', 'allowPartialData', 'requiredFeatures',
                      'maxDataRows', 'maxRenderNodes', 'a11y', 'platforms', 'fallbackMode'],
  A11yConstraints: ['minContrastRatio', 'requiresKeyboardNav', 'requiresScreenReader', 'ariaRole'],
  PlatformConstraint: ['platform', 'minVersion', 'unsupportedFeatures'],
  // ... etc
};
```

Add to B.6.3 Validation Requirements:

```typescript
const RenderConstraintsSchema = z.object({
  timeout: z.number().positive().optional(),
  requireData: z.boolean().optional(),
  allowPartialData: z.boolean().optional(),
  requiredFeatures: z.array(z.string()).optional(),
  maxDataRows: z.number().positive().optional(),
  maxRenderNodes: z.number().positive().optional(),
  a11y: z.object({
    minContrastRatio: z.number().min(1).max(21).optional(),
    requiresKeyboardNav: z.boolean().optional(),
    requiresScreenReader: z.boolean().optional(),
    ariaRole: z.string().optional(),
  }).optional(),
  platforms: z.array(z.object({
    platform: z.enum(['web', 'mobile', 'desktop', 'terminal']),
    minVersion: z.string().optional(),
    unsupportedFeatures: z.array(z.string()).optional(),
  })).optional(),
  fallbackMode: z.enum(['placeholder', 'empty', 'error']).optional(),
}).strict().optional();
```

## Verification Checklist
- [x] Interface covers all use cases from spec context
  - Timeout constraints from §B.3.2 (renderTimeout)
  - Data requirements from §19.1 (binding errors, empty states)
  - Platform support from §18.2 (AdapterMetadata)
  - Degradation behavior from §19.2 (graceful degradation levels)
  - Accessibility requirements (industry standard, WCAG compliance)
- [x] Types consistent with spec
  - Uses established patterns (optional fields, enums, numbers)
  - Follows naming conventions (camelCase, descriptive)
  - Integrates with existing types (no conflicts)
- [x] Added to B.6.1
  - Complete TypeScript interface definition
  - Supporting interfaces (A11yConstraints, PlatformConstraint)
  - Canonical ordering specification
  - Zod validation schema

## Confidence
**HIGH** - The RenderConstraints interface is derived directly from explicit requirements throughout the specification:

1. **Timeout constraints** - Explicitly mentioned in B.3.2: "renderTimeout: number" and "completes within timeout" test
2. **Data constraints** - Derived from §19.1 error categories (binding errors, missing data) and B.3.2 conformance (empty states)
3. **Feature constraints** - Implied by AdapterMetadata capabilities (supportsSignals, supportsStreaming, supportsLayout)
4. **Performance constraints** - Derived from conformance tests ("completes within timeout for large data")
5. **Platform constraints** - Directly from §18.2 AdapterMetadata.platform and supportedSchemaVersions
6. **Degradation behavior** - Explicitly defined in §19.2 (4 degradation levels: perfect, degraded, fallback, error)

The interface is comprehensive, backward-compatible (all fields optional), and addresses the adapter contract's need to validate block rendering feasibility before execution.
