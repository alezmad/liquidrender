# Entity Index Schema
# Defines structure for code-extracted entities (components, schemas, endpoints)
# Generated by extract.py, never maintained by hand

version: 1

description: |
  Maximally compressed index of code entities.
  Progressive tiers: meta -> index -> summary -> source.
  LLM expands tiers on demand.

structure:
  meta:
    description: "Root counts (Tier 0, always loaded)"
    example:
      components: 47
      schemas: 10
      endpoints: 25
      generated: "2025-12-27"
      from_commit: "abc123"

  categories:
    components:
      _index:
        description: "List of names (Tier 1)"
        type: array
        example: ["DataTable", "LineChart", "BarChart"]

      "[name]":
        tier1:
          description: "One-liner purpose"
          type: string
          max_tokens: 15
          example: "Sortable, filterable table with pagination"

        tier2:
          description: "Interface summary"
          type: object
          properties:
            path: "Relative file path"
            props: "Array of prop names"
            deps: "Array of dependencies"
            exports: "Array of export names"
          example:
            path: "components/data-table.tsx"
            props: ["data", "columns", "onSort", "onFilter"]
            deps: ["@radix-ui/react-table", "tokens"]
            exports: ["DataTable", "StaticDataTable"]

        tier3:
          description: "Full source (deferred)"
          value: "READ_FROM_DISK"

    schemas:
      _index:
        type: array
        example: ["user", "organization", "member"]

      "[name]":
        tier1:
          example: "User identity and auth"
        tier2:
          properties:
            path: "db/schema/user.ts"
            columns: ["id", "email", "name", "createdAt"]
            relations: ["organizations", "members"]

    endpoints:
      _index:
        type: array
        example: ["/api/users", "/api/orgs"]

      "[path]":
        tier1:
          example: "User CRUD operations"
        tier2:
          properties:
            file: "api/users/route.ts"
            methods: ["GET", "POST", "PUT", "DELETE"]
            auth: "required"

expansion_triggers:
  tier0_to_tier1:
    - "Task mentions category keyword"
    - "User asks 'what X exist?'"

  tier1_to_tier2:
    - "Task mentions specific entity name"
    - "Following dependency chain"

  tier2_to_tier3:
    - "Task requires modification"
    - "Debugging"
    - "User explicitly requests source"

token_budget:
  tier0: ~50
  tier1_per_category: ~100
  tier2_per_entity: ~50
  tier3: variable (read from disk)
