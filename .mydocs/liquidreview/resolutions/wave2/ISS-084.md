# Resolution: ISS-084

## Status: ✅ RESOLVED

## Issue Summary
**Title:** Empty Data Set
**Severity:** significant
**Target:** SPEC
**Section:** §9 Binding System, §19 Error Handling & Degradation

## Resolution

### Original Content
The specification describes binding behavior and error handling but does not explicitly define what happens when a data source returns an empty array or null value.

Partial references:
- §9.1: "A binding connects a block to data"
- §19.3: "Missing data shows 'No data' state"
- §B.3: "MUST handle missing data gracefully"

### Replacement Content

**Add to §9.6 "Data Presence Validation" (new subsection after §9.5):**

```markdown
### 9.6 Data Presence Validation

The binding system distinguishes between different data absence scenarios:

#### 9.6.1 Empty vs. Null Data

| Scenario | Data Value | Interpretation | Rendering Behavior |
|----------|-----------|----------------|-------------------|
| **Empty Array** | `[]` | Valid but empty collection | Render empty state UI |
| **Null Data** | `null` or `undefined` | Data source unavailable | Render placeholder with reason |
| **Empty Object** | `{}` | Valid but no fields | Render "No fields available" |
| **Zero Count** | Aggregate returns 0 | Valid result of zero | Render 0 normally |

#### 9.6.2 Empty State Rendering

When a binding resolves to an empty array (`[]`), blocks MUST render a meaningful empty state:

| Block Type | Empty State Rendering |
|------------|----------------------|
| `kpi` | Display "0" or "—" based on field type |
| `bar-chart`, `line-chart`, `pie-chart` | Show empty chart frame with message "No data to display" |
| `data-table` | Show table headers with row: "No records found" |
| `metric-group` | Render each metric with appropriate empty state |
| `comparison` | Display "—" for both current and previous values |

#### 9.6.3 Null Data Rendering

When a binding source is `null` or `undefined`, blocks MUST render a placeholder:

```typescript
interface EmptyStateConfig {
  type: 'empty' | 'null' | 'error';
  message?: string;
  icon?: 'no-data' | 'error' | 'info';
  action?: {
    label: string;
    onClick: () => void;
  };
}
```

**Default messages:**
- Empty array: "No data to display"
- Null source: "Data unavailable"
- Empty object: "No fields available"

#### 9.6.4 Adapter Requirements

Adapters MUST implement empty state rendering:

```typescript
interface LiquidAdapter<T> {
  // ... existing methods ...

  // MUST return valid empty state representation
  renderEmptyState(block: Block, reason: 'empty' | 'null' | 'no-fields'): T;
}
```

#### 9.6.5 LiquidCode Example

```liquidcode
# All blocks render appropriately when data is empty
#sales_dashboard;G2x2
K$revenue          # Shows "—" or "0" if data is []
L$date$amount      # Shows "No data to display" if data is []
T$orders           # Shows headers + "No records found" if data is []
```

#### 9.6.6 Validation Rules

The binding system validates data presence:

```typescript
function validateDataPresence(data: unknown): DataPresenceResult {
  if (data === null || data === undefined) {
    return { type: 'null', render: 'placeholder' };
  }

  if (Array.isArray(data) && data.length === 0) {
    return { type: 'empty', render: 'empty-state' };
  }

  if (typeof data === 'object' && Object.keys(data).length === 0) {
    return { type: 'no-fields', render: 'empty-state' };
  }

  return { type: 'present', render: 'normal' };
}
```

#### 9.6.7 Signal Behavior with Empty Data

Signals operate normally even with empty data:
- Filters can still be applied (resulting in empty filtered sets)
- Selections have no effect but don't error
- Signal state is preserved for when data becomes available

#### 9.6.8 Edge Case: Transition from Empty to Populated

When data transitions from empty to populated:
1. Adapter receives new data
2. Empty state UI is replaced with normal rendering
3. All signals are reapplied to new data
4. Layout recalculates if needed
```

**Add to §B.3.2 "Adapter Conformance" (enhancement):**

```markdown
// MUST handle empty data gracefully
'renders empty state for empty array []',
'renders placeholder for null data',
'renders empty state for empty object {}',
'distinguishes between zero value and no data',
'transitions correctly from empty to populated data',
```

## Verification Checklist
- [✓] Edge case fully specified (empty array, null, empty object, zero)
- [✓] Behavior deterministic (table defines exact rendering per block type)
- [✓] Error handling defined (empty state vs placeholder)
- [✓] Examples provided (LiquidCode, TypeScript validation)

## Confidence
**HIGH** - This resolution:
1. Provides clear distinction between empty, null, and zero scenarios
2. Defines deterministic rendering behavior per block type
3. Includes type definitions and validation logic
4. Aligns with existing error handling architecture (§19)
5. Extends adapter conformance requirements appropriately
