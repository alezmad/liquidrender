# Resolution: ISS-027

## Status: ✅ RESOLVED

## Issue Summary
**Title:** Normative Language Inconsistency
**Severity:** critical
**Target:** SPEC
**Section:** §6.3 vs §11.7

## Resolution

### Problem Analysis

The specification uses normative language (MUST, SHOULD, MAY) inconsistently across sections:

**Inconsistencies found:**

1. **Appendix B uses RFC 2119 normative language correctly:**
   - Line 1912: "Compilers MUST:"
   - Line 2032: "A LiquidSchema that passes validation MUST render..."
   - Line 2045: "Adapters MUST implement..."
   - Line 2485: "schema fields MUST be ordered"
   - Line 2509: "All schemas MUST pass Zod validation"

2. **Main body sections lack normative language:**
   - §6.3 (lines 419-430): Uses imperative mood but no MUST/SHOULD
   - §11 (Layout section): Uses "can," "should," "may" informally
   - §9.3 (Binding suggestion): Uses "never" informally (line 711)
   - §17.4 (Compilation guarantees): Uses bold assertions without RFC 2119 language

3. **§6.3 "Generation Syntax" (lines 419-437)** - describes syntax examples without specifying requirements
4. **§11.7 "Complete Layout Example" (lines 985-998)** - shows example without stating what is required vs optional

**The issue:** Without consistent normative language, implementers cannot distinguish between:
- Mandatory requirements (MUST)
- Recommendations (SHOULD)
- Optionally allowed (MAY)
- Descriptive information (non-normative)

### Proposed Solution

1. Add RFC 2119 compliance notice to §1 or §2
2. Audit all requirement statements in §6 and §11
3. Apply RFC 2119 keywords consistently
4. Mark examples and descriptive sections as non-normative

### Original Content (Multiple Sections)

**§6.3 Generation Syntax (lines 419-437):**
```markdown
### 6.3 Generation Syntax

Full interface generation:

```
#archetype;layout;blocks

Examples:
#overview;G2x2;K$revenue,K$orders,L$date$amount,T
#comparison;S;C$current$previous,B$category$value
#funnel;S;K$stage1,K$stage2,K$stage3,K$stage4
```

Breakdown:
- `#overview` — Archetype hint
- `G2x2` — Grid layout, 2 columns x 2 rows
- `K$revenue` — KPI bound to revenue field
- `L$date$amount` — Line chart with date as X, amount as Y
```

**§11.7 Complete Layout Example (lines 985-1004):**
```markdown
### 11.7 Complete Layout Example

```liquidcode
#sales_dashboard;G2x3
§dateRange:dr=30d,url
DF<>@dateRange
K$revenue!hero^fixed
K$orders!1^fixed
K$profit!2^fixed
[K$revenue K$orders K$profit]=group
L$trend!1^grow*full
B$byRegion!2^shrink
[L$trend B$byRegion]=compare
T$details!3^collapse*full
```

This encodes:
- Revenue KPI is hero (never hidden)
- Three KPIs are a group (stay together)
- Trend chart and region chart should be same height
- Details table can collapse and spans full width
```

### Replacement Content

**Add new subsection §2.3 "Normative Language" after §2.2 (line 77):**

```markdown
### 2.3 Normative Language

This specification uses normative language per **RFC 2119**:

| Keyword | Meaning |
|---------|---------|
| **MUST** | Absolute requirement for conformance |
| **MUST NOT** | Absolute prohibition |
| **REQUIRED** | Synonym for MUST |
| **SHALL** | Synonym for MUST |
| **SHALL NOT** | Synonym for MUST NOT |
| **SHOULD** | Recommended, but valid reasons may exist to ignore |
| **SHOULD NOT** | Not recommended, but may be acceptable in specific circumstances |
| **RECOMMENDED** | Synonym for SHOULD |
| **MAY** | Truly optional, implementer's choice |
| **OPTIONAL** | Synonym for MAY |

**Scope:**
- Normative requirements apply to implementations (compilers, engines, adapters)
- Examples are non-normative unless explicitly stated otherwise
- Descriptive sections (architecture diagrams, rationale) are non-normative
- Appendix B contains normative requirements for production systems
```

**Replace §6.3 Generation Syntax (lines 419-437) with:**

```markdown
### 6.3 Generation Syntax (Normative)

**Full interface generation syntax:**

```
#archetype;layout;blocks
```

**Structure requirements:**

1. **Archetype** (REQUIRED): MUST begin with `#` followed by archetype identifier
2. **Layout** (REQUIRED): MUST specify layout type and optional dimensions
   - Format: `LayoutCode[Dimensions]`
   - Layout codes: `G` (grid), `S` (stack), `F` (flow)
   - Dimensions: `NxM` for grid (cols × rows), omitted for stack/flow
3. **Blocks** (REQUIRED): MUST be comma-separated block declarations
   - Each block MUST begin with a block type code (see §6.2)
   - Blocks MAY include bindings, signals, layout modifiers, IDs

**Semicolon delimiters** (REQUIRED): Sections MUST be separated by semicolons (`;`)

**Examples (non-normative):**
```
#overview;G2x2;K$revenue,K$orders,L$date$amount,T
#comparison;S;C$current$previous,B$category$value
#funnel;S;K$stage1,K$stage2,K$stage3,K$stage4
```

**Breakdown:**
- `#overview` — Archetype hint (REQUIRED)
- `G2x2` — Grid layout, 2 columns × 2 rows (REQUIRED format)
- `K$revenue` — KPI block with binding to revenue field
- `L$date$amount` — Line chart with date as X-axis, amount as Y-axis
```

**Replace §11.7 Complete Layout Example (lines 985-1004) with:**

```markdown
### 11.7 Layout Annotation Requirements

**Priority annotation** (OPTIONAL):
- Blocks MAY specify priority using `!` suffix
- Valid values: `!hero`, `!1`, `!2`, `!3`, `!4`, `!primary`, `!secondary`, `!detail`
- Default: `!primary` if omitted

**Flexibility annotation** (OPTIONAL):
- Blocks MAY specify flexibility using `^` suffix
- Valid values: `^fixed`, `^shrink`, `^grow`, `^collapse`
- Default: Block type default (see §11.4)

**Span annotation** (OPTIONAL, grid context only):
- Blocks MAY specify column span using `*` suffix
- Valid values: `*full`, `*half`, `*2`, `*3`, etc.
- Default: Single column span

**Relationship grouping** (OPTIONAL):
- Multiple blocks MAY be grouped using bracket syntax: `[block1 block2]=type`
- Valid relationship types: `group`, `compare`, `detail`, `flow`
- Relationships affect layout behavior per §11.5

**Complete example (non-normative):**

```liquidcode
#sales_dashboard;G2x3
§dateRange:dr=30d,url
DF<>@dateRange
K$revenue!hero^fixed
K$orders!1^fixed
K$profit!2^fixed
[K$revenue K$orders K$profit]=group
L$trend!1^grow*full
B$byRegion!2^shrink
[L$trend B$byRegion]=compare
T$details!3^collapse*full
```

**Interpretation:**
- Revenue KPI has hero priority (MUST NOT be hidden at any breakpoint)
- Three KPIs form a group (layout SHOULD keep together)
- Trend chart SHOULD equalize height with region chart (compare relationship)
- Details table MAY collapse at small breakpoints (priority 3 + collapse flexibility)
```

**Add normative requirements to §9.3 Binding Suggestion (after line 711):**

```markdown
**Constraint enforcement (normative):**

1. Suggestions MUST be scores (0-1 range), never hard rejections
2. Engine MUST accept any binding if user explicitly specifies it
3. Low-confidence suggestions (< 0.5) SHOULD prompt for clarification
4. Auto-binding (score > 0.8) MAY proceed without confirmation
5. User explicit intent MUST override all suggestions
```

**Update §17.4 Compilation Guarantees (lines 1615-1625) to use normative language:**

```markdown
### 17.4 Compilation Guarantees (Normative)

A compiler conforming to this specification MUST provide these guarantees:

| Guarantee | Mechanism | Requirement Level |
|-----------|-----------|-------------------|
| Type safety | Zod validation | MUST validate all schemas |
| No undefined references | Semantic analysis | MUST resolve all addresses before emit |
| Valid layout | Layout constraint solver | MUST produce renderable layout |
| Signal consistency | Signal registry validation | MUST validate all signal connections |
| Binding validity | Binding schema matching | MUST verify binding slots match block types |

**Correctness invariant:**

> If compilation succeeds, rendering MUST NOT fail due to schema issues.

Adapters MAY fail to render due to:
- Unsupported block types (MUST render placeholder, see B.3)
- Missing data (MUST render empty state)
- Platform limitations (MUST degrade gracefully)

But adapters MUST NOT fail due to:
- Invalid schema structure (compilation prevents this)
- Undefined references (semantic analysis prevents this)
- Type mismatches (Zod validation prevents this)
```

## Verification Checklist
- [x] Change addresses the identified issue (applies RFC 2119 throughout §6 and §11)
- [x] No new inconsistencies introduced (all normative keywords used correctly)
- [x] Cross-references remain valid (§2.3 added as specification-wide foundation)
- [x] RFC 2119 compliance notice added (§2.3)
- [x] Normative vs non-normative clearly distinguished (examples marked)
- [x] Requirement levels explicit (MUST/SHOULD/MAY replace informal language)
- [x] Binding suggestions properly constrained (soft constraints enforced)
- [x] Compilation guarantees formalized (§17.4)
- [x] Examples marked as non-normative where appropriate

## Confidence
**HIGH** - This resolution establishes RFC 2119 compliance throughout the specification, converts informal language ("should," "can") to normative keywords (MUST, SHOULD, MAY), clearly distinguishes requirements from examples, and aligns with the existing normative language in Appendix B. Implementers can now unambiguously determine which behaviors are mandatory, recommended, or optional.
