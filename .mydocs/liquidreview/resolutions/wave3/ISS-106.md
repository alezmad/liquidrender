# ISS-106: Invalid Color Values in Binding

**Category:** Minor Edge Cases
**Priority:** Low
**Status:** Resolved

## Issue

When bindings specify color values (for color slots in charts), what happens if the value is invalid (malformed hex, unknown color name, null)?

## Resolution

### Color Validation Strategy

**The compiler validates color syntax but does NOT enforce a fixed palette.** Invalid colors are replaced with fallbacks at render time.

### Validation Rules

```typescript
interface ColorValue {
  type: 'hex' | 'name' | 'field' | 'expression';
  value: string;
}

// Validation at compile time
function validateColor(color: string): ColorValidation {
  if (/^#[0-9A-Fa-f]{6}$/.test(color)) {
    return { valid: true, type: 'hex' };
  }
  if (/^[a-z]+$/i.test(color)) {
    return { valid: true, type: 'name' };  // CSS named colors
  }
  if (color.startsWith('$')) {
    return { valid: true, type: 'field' };  // Field binding
  }
  if (color.includes('(')) {
    return { valid: true, type: 'expression' };  // LiquidExpr
  }
  return { valid: false, fallback: '#3b82f6' };  // Default blue
}
```

### Binding Color Slot

```typescript
interface FieldBinding {
  target: BindingSlot;
  field: string;
  transform?: string;
  // Color-specific options
  colorScheme?: 'categorical' | 'sequential' | 'diverging';
  colorPalette?: string[];  // Explicit palette
}
```

### Fallback Behavior

| Color Source | Invalid Value | Fallback |
|--------------|---------------|----------|
| Explicit value | `#gggggg` | Default theme color (`#3b82f6`) |
| Field binding | Field is null | Default color |
| Field binding | Field is non-color string | Try CSS name, else default |
| Expression | Returns invalid | Default color |
| Missing | No color slot filled | Adapter's default palette |

### Adapter Responsibility

Adapters MUST provide default color palettes:

```typescript
interface AdapterMetadata {
  // ... existing fields
  defaultColorPalette: {
    categorical: string[];     // For categories (10-12 colors)
    sequential: string[];      // For gradients (5-7 colors)
    diverging: string[];       // For +/- values (5-7 colors)
    accent: string;            // Primary accent
    muted: string;             // Secondary/background
  };
}
```

### Example

```liquidcode
# Valid color bindings
B$category:x$revenue:y$status:color    # Field-based color
B$category:x$revenue:y:"#ff6b6b":color # Explicit hex
B$category:x$revenue:y:"blue":color    # CSS name

# Invalid → fallback
B$category:x$revenue:y:"notacolor":color  # → default color
B$category:x$revenue:y$missingField:color # → null → default
```

## Specification Impact

**Minor addition to §9.1 (Binding System):**

Add color validation rules and fallback behavior to FieldBinding specification.

**Adapter requirement (§18.2):**

Adapters MUST provide `defaultColorPalette` in metadata.

## Related Sections

- §9.1: Binding Definition
- §9.2: Binding Slots by Block Type
- §18.2: Adapter Metadata
