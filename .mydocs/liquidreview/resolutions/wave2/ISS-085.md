# Resolution: ISS-085

## Status: ✅ RESOLVED

## Issue Summary
**Title:** Single Row Data
**Severity:** significant
**Target:** SPEC
**Section:** §9 Binding System, §11 Layout & Responsiveness System

## Resolution

### Original Content
The specification does not explicitly address how blocks should behave when bound to a single-item collection, which may affect layout, visualization rendering, and statistical computations.

Related sections:
- §9.2: "Binding Slots by Block Type" (defines multi-row assumptions)
- §11: Layout system (assumes multiple blocks, not single data item)

### Replacement Content

**Add to §9.7 "Single-Item Collection Handling" (new subsection after §9.6):**

```markdown
### 9.7 Single-Item Collection Handling

When a data binding resolves to a single-item collection (array with one element), blocks adapt their rendering appropriately.

#### 9.7.1 Single-Item Detection

```typescript
interface DataShape {
  itemCount: number;
  isSingle: boolean;    // true if array.length === 1
  isEmpty: boolean;     // true if array.length === 0
  isPlural: boolean;    // true if array.length > 1
}

function detectDataShape(data: unknown): DataShape {
  if (!Array.isArray(data)) {
    return { itemCount: 0, isSingle: false, isEmpty: true, isPlural: false };
  }

  return {
    itemCount: data.length,
    isSingle: data.length === 1,
    isEmpty: data.length === 0,
    isPlural: data.length > 1,
  };
}
```

#### 9.7.2 Block Behavior with Single-Item Data

| Block Type | Single-Item Behavior | Rationale |
|------------|---------------------|-----------|
| **kpi** | Renders normally (designed for single values) | KPIs typically show aggregated/single metrics |
| **bar-chart** | Renders single bar (valid visualization) | One bar is meaningful |
| **line-chart** | Renders single point (may show as marker) | Adapter may note "insufficient data for trend" |
| **pie-chart** | Renders single segment (100% pie) | Valid but may be uninformative |
| **data-table** | Renders table with single row | Valid, shows headers + one row |
| **comparison** | Renders normally if both values present | Designed for two values, not two rows |
| **metric-group** | Renders normally | Group can contain single metric |

#### 9.7.3 Statistical Edge Cases

Single-item data affects certain operations:

| Operation | Single-Item Behavior | Result |
|-----------|---------------------|--------|
| **Aggregation** | `sum([5])` → 5 | Valid |
| **Aggregation** | `avg([5])` → 5 | Valid |
| **Aggregation** | `count([x])` → 1 | Valid |
| **Grouping** | `groupBy` on single item | Single group |
| **Trend calculation** | Insufficient data | Return null or "—" |
| **Percentile** | `p50([5])` → 5 | Valid but uninformative |

#### 9.7.4 Adapter Rendering Hints

Adapters MAY provide visual hints for single-item data:

```typescript
interface RenderHints {
  isSingleItem?: boolean;
  message?: string;          // "Limited data - showing single record"
  showWarning?: boolean;     // Visual indicator for charts
}
```

**Example hint messages:**
- Line chart: "Trend requires multiple data points"
- Pie chart: "Single category (100%)"
- Table: "1 record"

#### 9.7.5 Layout Implications

Single-item data does NOT affect layout decisions:
- Grid layouts remain the same
- Block sizing follows normal rules
- Priority and flexibility are unchanged

**Rationale:** Layout describes structure, not data cardinality.

#### 9.7.6 LiquidCode Example

```liquidcode
# Interface renders correctly even with single-item data
#overview;G2x2
K$revenue              # Shows single value (normal KPI behavior)
B$category$amount      # Shows single bar (valid)
L$date$amount          # Shows single point (adapter may note insufficient trend data)
T$orders               # Shows table with 1 row
```

#### 9.7.7 Validation Rules

The engine does NOT reject single-item data:

```typescript
function validateBinding(binding: DataBinding, data: unknown[]): ValidationResult {
  // Single-item is VALID for all block types
  if (data.length === 1) {
    return {
      valid: true,
      warnings: detectWarnings(binding, data),  // May warn for trend charts
    };
  }

  return { valid: true };
}

function detectWarnings(binding: DataBinding, data: unknown[]): Warning[] {
  const warnings: Warning[] = [];

  if (data.length === 1) {
    // Warn for blocks that benefit from multiple items
    if (binding.blockType === 'line-chart') {
      warnings.push({
        type: 'insufficient-data',
        message: 'Line chart with single data point cannot show trend',
        severity: 'info',
      });
    }
  }

  return warnings;
}
```

#### 9.7.8 Difference from Empty Data

| Scenario | Data | Rendering |
|----------|------|-----------|
| Empty | `[]` | Empty state (§9.6.2) |
| Single-item | `[{...}]` | Normal rendering with single item |
| Multi-item | `[{...}, {...}]` | Normal rendering |

**Key distinction:** Single-item data is **valid data** and renders normally, not as an empty state.

#### 9.7.9 Comparison Block Special Case

Comparison blocks require TWO VALUES, not two rows:

```typescript
// This is a SINGLE ROW with TWO FIELDS
const comparisonData = [
  { current: 100, previous: 85 }  // ✓ Renders comparison correctly
];

// This is TWO ROWS (not intended for comparison block)
const wrongData = [
  { value: 100 },
  { value: 85 }
];  // Use binding.fields to map to current/previous
```

#### 9.7.10 Future: Minimum Data Hints

Block types MAY specify minimum recommended item counts:

```typescript
interface BlockTypeSpec {
  type: BlockType;
  minRecommendedItems?: number;   // Hint, not requirement
  optimalItemRange?: [number, number];
}

const BLOCK_SPECS: BlockTypeSpec[] = [
  { type: 'line-chart', minRecommendedItems: 3, optimalItemRange: [5, 100] },
  { type: 'pie-chart', minRecommendedItems: 2, optimalItemRange: [3, 8] },
  { type: 'kpi', minRecommendedItems: 1 },  // Designed for single values
];
```

These are HINTS for discovery/suggestion, not validation errors.
```

## Verification Checklist
- [✓] Edge case fully specified (single-item collections)
- [✓] Behavior deterministic (table defines rendering per block type)
- [✓] Error handling defined (warnings vs errors, validation rules)
- [✓] Examples provided (data shapes, validation logic, LiquidCode)

## Confidence
**HIGH** - This resolution:
1. Clearly distinguishes single-item from empty and multi-item scenarios
2. Defines deterministic behavior for each block type
3. Addresses statistical edge cases (aggregation, trends)
4. Clarifies that single-item is valid data, not an error condition
5. Provides future-compatible hints for optimal data ranges
6. Includes comprehensive validation logic
